---
title: "Social XSL Visualization and Analysis Code"
author: "Kyle MacDonald & Allison Dods"
date: "August 4, 2014"
output: html_document
---

##Script for visualizing and analyzing soc-xsit-ipad data.

Load libraries and helper functions.
```{r load libraries, message=FALSE, warning=FALSE}
library(plyr)
library(dplyr)
library(bootstrap)
library(lme4)
library(ggplot2)
source("/Users/kmacdonald/Documents/Projects/SOC_XSIT/XSIT-MIN/analysis/Ranalysis/useful.R")
```

Read in the data. 

```{r read-data}
data.all_df <- read.csv("/Users/kmacdonald/Documents/Projects/SOC_XSIT/processed_data/child/soc-xsit-ipad-alldata.csv")
data.test_df <- read.csv("/Users/kmacdonald/Documents/Projects/SOC_XSIT/processed_data/child/soc-xsit-ipad-testdata.csv")
```

### Summarize data set. 
Get the number of subjects 
```{r num_subs}
data.test_df %>%
        summarise(n_subjects = n_distinct(id)) %>%
        print()
```
Get condition breakdown
```{r condition_breakdown}
data.test_df %>%
        group_by(condition) %>%
        summarise(n_subjects = n_distinct(id)) %>%
        print()
```
Get age by condition breakdown
```{r condition_by_age}
data.test_df %>%
        group_by(age_group, condition) %>%
        summarise(n_subject = n_distinct(id)) %>%
        print()
```
Get trial by kid breakdown. We will use this to decide which kids to keep
in the analysis. 
```{r trial_breakdown}
include_df <- data.test_df %>%
                group_by(id, trial_type_redo) %>%
                summarise(n_trial = n()) %>%
                mutate(include_trial = ifelse(n_trial >= 2, 1,0)) %>%
                summarise(sum(include_trial))

include_df <- include_df %>% 
                        mutate(include_kid = ifelse(include_df[,2] == 2, 1,0)) %>%
                        select(id, include_kid)

#Keep only kids who got at least 2 same/switch trials
data.test_df <- join(data.test_df, include_df, by="id")
```
Keep only the first two test trials for each trial type.
```{r keep_trials}
## this is tricky!
# function that takes in a data frame
flag_trials <- function(df) {
        # iterate over trial_type_redo column
        # build array for same and switch
        # if array length is greater than 2, then we filter out that trial
}

data.test_df %>%
        group_by(id, trial_type_redo) %>%
        summarise(n_trial = n()) %>%
        head()
```

Compute means: not collapsing by kid

```{r means}
means <- data.test_df %>%
                filter(include == 1) %>%
                group_by(condition, trial_type_redo) %>%
                summarise(mean(correct))
```

Compute means: filtering out younger kids and kids who got exposure trial wrong

```{r means-filtered}
means.filtered <- data.test_df %>%
                        filter(
                                include == 1, 
                                age_group == 4 | age_group == 5, 
                                condition == "No-social" | correct_exposure == TRUE 
                                ) %>%
                        group_by(condition, trial_type_redo) %>%
                        summarise(mean_correct = mean(correct), 
                                  ci_high = ci.high(correct), 
                                  ci_low = ci.low(correct), n_trial = n()
                                  )

acc.exp <- data.test_df %>%
                filter(condition == "Social") %>%
                group_by(include) %>%
                summarise(mean_correct = mean(correct_exposure),
                          ci_high = ci.high(correct_exposure),
                          ci_low = ci.low(correct_exposure)
                          )
```

Plot the data.

```{r plots}
acc.expo <- ggplot(data = means.filtered, aes(x = condition, y = mean_correct, colour = condition)) +
                geom_point() + 
                geom_errorbar(aes(ymin = mean_correct - ci_low, ymax = mean_correct + ci_high), width = 0.1) +
                geom_hline(yintercept = 0.5, linetype = "dashed")

acc.test <- ggplot(data = means.filtered, aes(x = condition, y = mean_correct, colour = condition)) +
                geom_point() + 
                geom_errorbar(aes(ymin = mean_correct - ci_low, ymax = mean_correct + ci_high), width = 0.1) +
                geom_hline(yintercept = 0.5, linetype = "dashed")


      
```

Run stats.

```{r stats}

```

Mixed models.

```{r models}


```
